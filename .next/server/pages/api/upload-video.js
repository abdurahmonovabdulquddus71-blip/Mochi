"use strict";(()=>{var e={};e.id=310,e.ids=[310],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6705:e=>{e.exports=import("formidable")},6544:e=>{e.exports=import("node-fetch")},7147:e=>{e.exports=require("fs")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},9249:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>s,routeModule:()=>p});var r=a(1802),i=a(7153),n=a(6249),l=a(8204),d=e([l]);l=(d.then?(await d)():d)[0];let s=(0,n.l)(l,"default"),u=(0,n.l)(l,"config"),p=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/upload-video",pathname:"/api/upload-video",bundlePath:"",filename:""},userland:l});o()}catch(e){o(e)}})},8204:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{config:()=>f,default:()=>p});var r=a(6705),i=a(7147),n=a.n(i),l=a(6544),d=e([r,l]);[r,l]=d.then?(await d)():d;let f={api:{bodyParser:!1}};async function s(){let e=Buffer.from("005388ef1432aec000000000f:K005ChhVWS9ULMO2oxsQwcZzJCZw6tk").toString("base64"),t=await (0,l.default)("https://api.backblazeb2.com/b2api/v2/b2_authorize_account",{method:"GET",headers:{Authorization:`Basic ${e}`}}),a=await t.text();if(!t.ok)throw console.error("❌ B2 autentifikatsiya xatosi:",a),Error("B2 autentifikatsiya xatosi");return JSON.parse(a)}async function u(e,t,a,o){let r=await (0,l.default)(`${o.apiUrl}/b2api/v2/b2_get_upload_url`,{method:"POST",headers:{Authorization:o.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify({bucketId:"5388d88e9fc174c3929a0e1c"})}),i=await r.text();if(!r.ok)throw console.error("❌ Upload URL olishda xato:",i),Error("Upload URL olishda xato");let d=JSON.parse(i),s=n().readFileSync(e),u=await (0,l.default)(d.uploadUrl,{method:"POST",headers:{Authorization:d.authorizationToken,"X-Bz-File-Name":encodeURIComponent(t),"Content-Type":a||"video/mp4","X-Bz-Content-Sha1":"do_not_verify","X-Bz-Info-Author":"anime-admin"},body:s}),p=await u.text();if(!u.ok)throw console.error("❌ Fayl yuklashda xato:",p),Error("Fayl yuklashda xato");let f=JSON.parse(p),c=`${o.downloadUrl}/file/malika-memory/${t}`;return{fileId:f.fileId,fileName:f.fileName,downloadUrl:c}}async function p(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let a=(0,r.default)({maxFileSize:1048576e4}),[o,i]=await new Promise((t,o)=>{a.parse(e,(e,a,r)=>{e?o(e):t([a,r])})}),l=i.video?.[0],d=o.episode_number?.[0],p=o.anime_id?.[0];if(!l)return t.status(400).json({error:"Video fayl topilmadi"});let f=await s(),c=l.originalFilename.split(".").pop(),h=`anime_${p}_episode_${d}_${Date.now()}.${c}`,m=await u(l.filepath,h,l.mimetype,f);return n().unlinkSync(l.filepath),t.status(200).json(m)}catch(e){return console.error("❌ Upload error:",e),t.status(500).json({error:e.message})}}o()}catch(e){o(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=9249);module.exports=a})();